(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{0:function(e,t,a){e.exports=a("2f39")},"0d64":function(e,t,a){},"104d":function(e,t){},"1f5a":function(e,t,a){"use strict";var s=a("8e3b"),r=a.n(s);r.a},"2d97":function(e,t,a){"use strict";t["a"]={methods:{showSuccNotif(e){this.$q.notify({message:e,color:"positive",icon:"done",timeout:500})},showWarnNotif(e){this.$q.notify({message:e,color:"warning",icon:"warning"})},showErrNotif(e){this.$q.notify({message:e,color:"negative",icon:"bug_report"})}}}},"2f39":function(e,t,a){"use strict";a.r(t);a("7d6e"),a("e54f"),a("985d"),a("31cd");var s=a("2b0e"),r=a("1f91"),i=a("42d2"),o=a("b05d"),n=a("18d6"),l=a("a639"),c=a("2a19");s["a"].use(o["a"],{config:{},lang:r["a"],iconSet:i["a"],plugins:{LocalStorage:n["a"],SessionStorage:l["a"],Notify:c["a"]}});var d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"q-app"}},[e.running?a("router-view"):e._e(),e.running?e._e():a("div",{staticClass:"text-center"},[a("h3",[e._v("无法连接服务器")]),a("h3",[e._v("Network Error")]),a("h5",[e._v("请检查你的网络设置")]),a("h5",[e._v("Please check you network settings")])])],1)},u=[],p={name:"App",data(){return{running:!0}},methods:{checkIsRunning(){this.$axios({method:"get",url:"/api/health",timeout:5e3}).then(()=>{this.running=!0}).catch(()=>{this.running=!1,this.checkIsRunning()})}},created(){this.checkIsRunning()}},m=p,h=a("2877"),g=Object(h["a"])(m,d,u,!1,null,null,null),w=g.exports,v=a("2f62"),f=function(){return{hide:!1,wantPlaying:!1,playing:!1,currentTime:0,duration:0,source:"",queue:[],queueIndex:0,playMode:{id:0,name:"order"},muted:!1,volume:0,currentLyric:"",sleepTime:null,sleepMode:!1,rewindSeekTime:5,forwardSeekTime:30,rewindSeekMode:!1,forwardSeekMode:!1,lyricContent:"",shouldLoadPlayer:!1}};const b={currentPlayingFile:e=>e.queue[e.queueIndex]||{hash:"",title:"",workTitle:"",mediaStreamUrl:"",mediaDownloadUrl:"",samCoverUrl:"",thumbnailCoverUrl:"",mainCoverUrl:""}};var k=b;const q={TOGGLE_HIDE(e){e.hide=!e.hide},LOAD_PLAYER(e){e.shouldLoadPlayer=!0},WANT_PLAY(e){e.wantPlaying=!0},WANT_PAUSE(e){e.wantPlaying=!1},TOGGLE_WANT_PLAYING(e){e.wantPlaying=!1,e.wantPlaying=!e.playing},ON_PLAY(e){e.playing=!0},ON_PAUSE(e){e.playing=!1},SET_TRACK:(e,t)=>{t>=e.queue.length||t<0||(e.wantPlaying=!0,e.queueIndex=t)},NEXT_TRACK:e=>{e.queueIndex<e.queue.length-1&&(e.wantPlaying=!0,e.queueIndex+=1)},PREVIOUS_TRACK:e=>{e.queueIndex>0&&(e.wantPlaying=!0,e.queueIndex-=1)},SET_QUEUE(e,t){e.queue=t.queue,e.queueIndex=t.index,t.resetPlaying&&(e.wantPlaying=!0)},EMPTY_QUEUE:e=>{e.wantPlaying=!1,e.queue=[],e.queueIndex=0},ADD_TO_QUEUE:(e,t)=>{e.queue.push(t)},REMOVE_FROM_QUEUE:(e,t)=>{e.queue.splice(t,1),t===e.queueIndex?(e.playing=!1,e.wantPlaying=!1,e.queueIndex=0):t<e.queueIndex&&(e.queueIndex-=1)},SET_DURATION(e,t){e.duration=t},SET_CURRENT_TIME(e,t){e.currentTime=t},PLAY_NEXT:(e,t)=>{e.queue.splice(e.queueIndex+1,0,t)},CHANGE_PLAY_MODE:e=>{const t=[{id:0,name:"order"},{id:1,name:"all repeat"},{id:2,name:"repeat once"},{id:3,name:"shuffle"}],a=e.playMode.id>=t.length-1?0:e.playMode.id+1;e.playMode=t[a]},TOGGLE_MUTED:e=>{e.muted=!e.muted},SET_VOLUME:(e,t)=>{t<0||t>1||(e.volume=t)},SET_REWIND_SEEK_TIME:(e,t)=>{e.rewindSeekTime=t},SET_FORWARD_SEEK_TIME:(e,t)=>{e.forwardSeekTime=t},SET_REWIND_SEEK_MODE:(e,t)=>{e.rewindSeekMode=t},SET_FORWARD_SEEK_MODE:(e,t)=>{e.forwardSeekMode=t},SET_CURRENT_LYRIC:(e,t)=>{e.currentLyric=t},SET_SLEEP_TIMER:(e,t)=>{e.sleepTime=t,e.sleepMode=!0},CLEAR_SLEEP_MODE:e=>{e.sleepTime=null,e.sleepMode=!1},SET_LYRIC_CONTENT:(e,t)=>{e.lyricContent=t}};var y=q,_=a("6a18"),x={namespaced:!0,getters:k,mutations:y,actions:_,state:f},C=function(){return{auth:!1,name:"",group:"",reg:!1}},$=a("b5fb");const S={INIT(e,t){e.name=t.name,e.group=t.group},SET_AUTH(e,t){e.auth=t},SET_REG(e,t){e.reg=t}};var E=S,R=a("104d"),T={namespaced:!0,state:C,getters:$,mutations:E,actions:R};s["a"].use(v["a"]);var N=function(){const e=new v["a"].Store({modules:{AudioPlayer:x,User:T},strict:!1});return e},P=a("8c4f"),I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-layout",{class:""+(!this.$q.dark.isActive&&"bg-grey-3"),attrs:{view:"hHh Lpr lFf"}},[a("q-header",{staticClass:"shadow-4"},[a("q-toolbar",{staticClass:"row justify-between",class:e.$q.dark.isActive&&"bg-dark"},[a("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu"},on:{click:function(t){e.drawerOpen=!e.drawerOpen}}}),e.isNotAtHomePage?a("q-btn",{attrs:{flat:"",size:"md",icon:"arrow_back_ios"},on:{click:function(t){return e.back()}}}):e._e(),a("q-toolbar-title",{staticClass:"gt-xs"},[a("router-link",{staticClass:"text-white",attrs:{to:"/"}},[e._v("\n            Kikoeru\n          ")])],1),a("q-input",{staticClass:"q-mr-sm",attrs:{dark:"",dense:"",rounded:"",standout:"",debounce:"500","input-class":"text-right"},scopedSlots:e._u([{key:"append",fn:function(){return[""===e.keyword?a("q-icon",{attrs:{name:"search"}}):a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(t){e.keyword=""}}})]},proxy:!0}]),model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e.shouldLoadPlayer?a("AudioPlayer"):e._e()],1),a("q-drawer",{attrs:{"show-if-above":"",mini:e.miniState,"mini-to-overlay":"",width:230,breakpoint:500,bordered:"","content-class":""+(!this.$q.dark.isActive&&"bg-grey-1")},on:{mouseover:function(t){e.miniState=!1},mouseout:function(t){e.miniState=!0}},model:{value:e.drawerOpen,callback:function(t){e.drawerOpen=t},expression:"drawerOpen"}},[a("q-scroll-area",{staticClass:"fit"},[a("q-list",[e._l(e.links,(function(t,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,attrs:{clickable:"",exact:"",to:t.path,"active-class":"text-deep-purple text-weight-medium"},on:{click:function(t){e.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:t.icon}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                "+e._s(t.title)+"\n              ")])],1)],1)})),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:e.randomPlay}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"shuffle"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                "+e._s(e.$t("sidebar.randomPlay"))+"\n              ")])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(t){e.showTimer=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"bedtime"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                "+e._s(e.$t("sidebar.sleepMode"))+"\n              ")])],1)],1)],2),a("q-list",[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(t){return e.$q.dark.toggle()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:this.$q.dark.isActive?"wb_sunny":"nights_stay"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                "+e._s(e.$t("sidebar.darkMode"))+"\n              ")])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"",to:"/about","active-class":"text-deep-purple text-weight-medium"},on:{click:function(t){e.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"info"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                "+e._s(e.$t("sidebar.about"))+"\n              ")])],1)],1),"administrator"===this.$store.state.User.group?a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"",to:"/admin","active-class":"text-deep-purple text-weight-medium"},on:{click:function(t){e.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"tune"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                设定\n              ")])],1)],1):e._e(),e.authEnabled?a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(t){e.confirm=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"exit_to_app"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[e._v("\n                "+e._s(e.$t("sidebar.logout"))+"\n              ")]),a("q-item-label",{attrs:{caption:"",lines:"2"}},[e._v(e._s(e.userName))])],1)],1):e._e()],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.confirm,callback:function(t){e.confirm=t},expression:"confirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{attrs:{icon:"power_settings_new",color:"primary","text-color":"white"}}),a("span",{staticClass:"q-ml-sm"},[e._v(e._s(e.$t("sidebar.doubleCheckLogout")))])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("sidebar.doubleCheckLogoutCancel"),color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("sidebar.doubleCheckLogoutConfirm"),color:"primary"},on:{click:function(t){return e.logout()}}})],1)],1)],1),a("SleepMode",{model:{value:e.showTimer,callback:function(t){e.showTimer=t},expression:"showTimer"}}),a("q-page-container",[a("keep-alive",{attrs:{include:"Works"}},[a("router-view")],1),a("q-page-scroller",{attrs:{position:"bottom-right","scroll-offset":150,offset:[18,18],id:"gotop"}},[a("q-btn",{attrs:{fab:"",icon:"keyboard_arrow_up",color:"accent"}})],1)],1),a("q-footer",{staticClass:"q-pa-none"},[e.shouldLoadPlayer?a("LyricsBar"):e._e(),e.shouldLoadPlayer?a("PlayerBar"):e._e()],1)],1)},L=[],M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-dialog",{attrs:{value:e.value,persistent:""},on:{input:function(t){return e.$emit("input")}}},[a("q-card",[a("div",{staticClass:"q-pa-sm"},[a("q-time",{attrs:{"now-btn":"",dark:e.sleepMode},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),a("div",{staticClass:"row justify-between"},[a("q-card-actions",[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消定时",color:"primary",disable:!e.sleepMode},on:{click:e.clearSleepTimer}})],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",color:"primary"},on:{click:e.setSleepTimer}})],1)],1)])],1)},O=[],Q={name:"SleepMode",props:["value"],data(){return{time:"00:00"}},computed:{...Object(v["d"])("AudioPlayer",["sleepTime","sleepMode"])},mounted(){try{this.$q.sessionStorage.getItem("sleepMode")&&this.SET_SLEEP_TIMER(this.$q.sessionStorage.getItem("sleepTime"))}catch{console.log("Web Storage API error")}},watch:{value(e){if(e)if(this.sleepMode)this.time=this.sleepTime;else{const e=new Date;this.time=e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")}}},methods:{...Object(v["c"])("AudioPlayer",["SET_SLEEP_TIMER","CLEAR_SLEEP_MODE"]),setSleepTimer(){this.SET_SLEEP_TIMER(this.time);try{this.$q.sessionStorage.set("sleepTime",this.time),this.$q.sessionStorage.set("sleepMode",!0)}catch{console.log("Web Storage API error")}this.showSuccNotif(`将于${this.time}停止播放`)},clearSleepTimer(){this.CLEAR_SLEEP_MODE();try{this.$q.sessionStorage.set("sleepTime",null),this.$q.sessionStorage.set("sleepMode",!1)}catch{console.log("Web Storage API error")}this.showSuccNotif("已关闭睡眠模式")},showSuccNotif(e){this.$q.notify({message:e,color:"primary",icon:"bedtime",timeout:5e3})}}},D=Q,A=a("24e8"),U=a("f09f"),j=a("ca78"),W=a("4b7e"),F=a("9c40"),B=a("7f67"),z=a("eebe"),J=a.n(z),Y=Object(h["a"])(D,M,O,!1,null,null,null),G=Y.exports;J()(Y,"components",{QDialog:A["a"],QCard:U["a"],QTime:j["a"],QCardActions:W["a"],QBtn:F["a"]}),J()(Y,"directives",{ClosePopup:B["a"]});var H=a("2d97"),K=a("9224"),V=a("b06b"),X={methods:{notifyUpdate:function(e){let t=[{label:"忽略",color:"white"}];{let e="https://blog.asmr.one/frontend-"+K["a"].replace(".","-");t.push({label:"查看",color:"yellow",handler:()=>{Object(V["a"])(e)}})}this.$q.notify({message:"新版本发布！",caption:"v"+e,color:"positive",icon:"done",timeout:1e4,multiLine:!1,actions:t})},hasUpdate(e,t){let a=e.split(".").slice(0,-1).join("."),s=t.split(".").slice(0,-1).join(".");return a!==s},doUpdate(e){this.$q.localStorage.set("localVersion",e)}},mounted(){let e=this.$q.localStorage.getItem("localVersion");e&&this.hasUpdate(e,K["a"])?(this.notifyUpdate(K["a"]),this.doUpdate(K["a"])):e||this.doUpdate(K["a"])}},Z={name:"MainLayout",mixins:[H["a"],X],components:{PlayerBar:()=>a.e(11).then(a.bind(null,"55e9")),AudioPlayer:()=>Promise.all([a.e(2),a.e(5)]).then(a.bind(null,"7901")),LyricsBar:()=>a.e(6).then(a.bind(null,"4764")),SleepMode:G},data(){return{keyword:"",drawerOpen:!1,miniState:!0,confirm:!1,randId:null,showTimer:!1,links:[{title:this.$t("sidebar.library"),icon:"widgets",path:"/"},{title:this.$t("sidebar.myFavourites"),icon:"favorite",path:"/favourites"},{title:this.$t("sidebar.circles"),icon:"group",path:"/circles"},{title:this.$t("sidebar.tags"),icon:"label",path:"/tags"},{title:this.$t("sidebar.vas"),icon:"mic",path:"/vas"}],sharedConfig:{}}},watch:{"$q.dark.isActive"(e){this.$q.localStorage.set("dark",e)},keyword(){this.$router.push(this.keyword?"/works?keyword="+this.keyword:"/works")},randId(){this.$router.push("/work/RJ"+this.randId)},sharedConfig(e){this.SET_REWIND_SEEK_TIME(e.rewindSeekTime),this.SET_FORWARD_SEEK_TIME(e.forwardSeekTime)}},mounted(){this.initUser(),this.checkUpdate(),this.readSharedConfig(),this.$q.localStorage.has("dark")&&this.$q.localStorage.getItem("dark")&&this.$q.dark.set(!0)},computed:{isNotAtHomePage(){const e=this.$route.path;return e&&"/"!==e&&"/works"!==e&&"/favourites"!==e},...Object(v["d"])("User",{userName:"name",authEnabled:"auth"}),...Object(v["d"])("AudioPlayer",["shouldLoadPlayer"])},methods:{...Object(v["c"])("AudioPlayer",["SET_REWIND_SEEK_TIME","SET_FORWARD_SEEK_TIME"]),initUser(){this.$axios.get("/api/auth/me").then(e=>{this.$store.commit("User/INIT",e.data.user),this.$store.commit("User/SET_AUTH",e.data.auth),this.$store.commit("User/SET_REG",e.data.reg)}).catch(e=>{if(e.response)if(401===e.response.status){const e=this.$router.currentRoute.path;"/login"!==e&&this.$router.push("/login")}else this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`);else this.showErrNotif(e.message||e)})},checkUpdate(){this.$axios.get("/api/version").then(e=>{e.data.update_available&&e.data.notifyUser&&this.$q.notify({message:"GitHub上有新版本",color:"primary",textColor:"white",icon:"cloud_download",timeout:5e3,actions:[{label:"好",color:"white"},{label:"查看",color:"white",handler:()=>{Object.assign(document.createElement("a"),{target:"_blank",href:"https://github.com/umonaca/kikoeru-express/releases"}).click()}}]}),e.data.lockFileExists&&this.$q.notify({message:e.data.lockReason,type:"warning",timeout:6e4,actions:[{label:"以后提醒我",color:"black"},{label:"前往扫描页",color:"black",handler:()=>this.$router.push("/admin/scanner")}]})}).catch(e=>{console.error(e)})},readSharedConfig(){this.$axios.get("/api/config/shared").then(e=>{this.sharedConfig=e.data.sharedConfig}).catch(e=>{if(e.response)if(401===e.response.status){const e=this.$router.currentRoute.path;"/login"!==e&&this.$router.push("/login")}else this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`);else this.showErrNotif(e.message||e)})},randomPlay(){this.requestRandomWork()},requestRandomWork(){const e={order:"betterRandom"};this.$axios.get("/api/works",{params:e}).then(e=>{const t=e.data.works;this.randId=t.length?t[0].id:null}).catch(e=>{e.response?401!==e.response.status&&this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})},logout(){this.$q.localStorage.set("jwt-token",""),this.$router.push("/login")},back(){this.$router.go(-1)}}},ee=Z,te=(a("89d3"),a("4d5a")),ae=a("e359"),se=a("65c6"),re=a("6ac5"),ie=a("27f9"),oe=a("0016"),ne=a("9404"),le=a("4983"),ce=a("1c1c"),de=a("66e5"),ue=a("4074"),pe=a("0170"),me=a("a370"),he=a("cb32"),ge=a("09e3"),we=a("9989"),ve=a("5096"),fe=a("7ff0"),be=a("714f"),ke=Object(h["a"])(ee,I,L,!1,null,null,null),qe=ke.exports;J()(ke,"components",{QLayout:te["a"],QHeader:ae["a"],QToolbar:se["a"],QBtn:F["a"],QToolbarTitle:re["a"],QInput:ie["a"],QIcon:oe["a"],QDrawer:ne["a"],QScrollArea:le["a"],QList:ce["a"],QItem:de["a"],QItemSection:ue["a"],QItemLabel:pe["a"],QDialog:A["a"],QCard:U["a"],QCardSection:me["a"],QAvatar:he["a"],QCardActions:W["a"],QPageContainer:ge["a"],QPage:we["a"],QPageScroller:ve["a"],QFooter:fe["a"]}),J()(ke,"directives",{Ripple:be["a"],ClosePopup:B["a"]});var ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"text-h5 text-weight-regular q-ma-md"},[e._v("\n    "+e._s(e.pageTitle)+"\n    "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.pagination.totalCount,expression:"pagination.totalCount"}]},[e._v("\n      ("+e._s(e.pagination.totalCount)+")\n    ")])]),a("div",{class:"row justify-center "+("list"===e.displayMode?"list":"q-mx-md")},[a("q-page",{staticClass:"col"},[a("div",{staticClass:"row justify-between q-mb-md q-mr-sm"},[a("q-select",{staticClass:"col-auto",attrs:{dense:"",rounded:"",outlined:"","bg-color":e.color,"transition-show":"scale","transition-hide":"scale",options:e.options,label:e.$t("works.sort")},model:{value:e.sortOption,callback:function(t){e.sortOption=t},expression:"sortOption"}}),a("q-checkbox",{staticClass:"row",attrs:{label:"带字幕"},model:{value:e.subtitleOnly,callback:function(t){e.subtitleOnly=t},expression:"subtitleOnly"}}),a("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"view_module",value:"thumbnail"},{icon:"view_column",value:"detail"},{icon:"list",value:"list"}]},model:{value:e.displayMode,callback:function(t){e.displayMode=t},expression:"displayMode"}})],1),"list"===e.displayMode?a("q-list",{staticClass:"shadow-2",attrs:{bordered:"",separator:""}},e._l(e.works,(function(e){return a("WorkListItem",{key:e.id,attrs:{metadata:e,showLabel:!0}})})),1):a("div",{staticClass:"row q-col-gutter-x-md q-col-gutter-y-lg"},e._l(e.works,(function(t){return a("div",{key:t.id,staticClass:"col-xs-12 col-sm-6 col-md-4",class:"detail"===e.displayMode?"col-lg-3 col-xl-2":"col-lg-2 col-xl-2"},[a("WorkCard",{staticClass:"fit",attrs:{metadata:t,thumbnailMode:"thumbnail"===e.displayMode}})],1)})),0),a("div",{directives:[{name:"show",rawName:"v-show",value:e.stopLoad&&0===e.maxPage,expression:"stopLoad && maxPage === 0"}],staticClass:"q-mt-lg q-mb-xl text-h6 text-bold text-center"},[e._v("END")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1),a("div",{staticClass:"q-pa-lg flex flex-center"},[a("q-pagination",{directives:[{name:"show",rawName:"v-show",value:e.maxPage,expression:"maxPage"}],attrs:{max:e.maxPage,"max-pages":7,"boundary-numbers":!1,input:""},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"guest"===e.userName,expression:"userName === 'guest'"}],staticClass:"flex flex-center"},[e._v(e._s(e.$t("works.guestLoginRateLimitTips")))])],1)],1)])},_e=[],xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-card",[a("router-link",{attrs:{to:"/work/RJ"+e.metadata.id}},[a("CoverSFW",{attrs:{"cover-url":e.coverUrl,workid:e.metadata.id,nsfw:!1,release:e.metadata.release}})],1),a("q-separator"),e.thumbnailMode?e._e():a("div",[a("div",{staticClass:"q-mx-sm text-h6 text-weight-regular ellipsis-2-lines"},[a("router-link",{staticStyle:{color:"inherit"},attrs:{to:"/work/RJ"+e.metadata.id}},[e._v("\n        "+e._s(e.metadata.title)+"\n      ")])],1),a("div",{staticClass:"q-ml-sm q-mt-sm q-mb-xs text-subtitle1 text-weight-regular ellipsis"},[a("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+e.metadata.circle.id}},[e._v("\n        "+e._s(e.metadata.circle.name)+"\n      ")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.metadata.title,expression:"metadata.title"}],staticClass:"row items-center"},[a("div",{staticClass:"col-auto q-ml-sm"},[a("q-rating",{attrs:{size:"sm",color:e.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:e.rating,callback:function(t){e.rating=t},expression:"rating"}}),e.metadata.rate_count_detail?a("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[a("div",[e._v(e._s(e.$t("workCard.averageStar"))+": "+e._s(e.metadata.rate_average_2dp))]),e._l(e.sortedRatings,(function(t,s){return a("div",{key:s,staticClass:"row items-center"},[a("div",{staticClass:"col"},[e._v(e._s(t.review_point)),a("q-icon",{attrs:{name:"star"}})],1),a("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:t.ratio/100,color:"amber","track-color":"white"}}),a("div",{staticClass:"col q-mx-sm"},[e._v("("+e._s(t.count)+")")])],1)}))],2):e._e()],1),a("div",{staticClass:"col-auto"},[a("span",{staticClass:"text-weight-medium text-body1 text-red"},[e._v(e._s(e.metadata.rate_average_2dp))]),a("span",{staticClass:"text-grey"},[e._v(" ("+e._s(e.metadata.rate_count)+")")])]),a("div",{staticClass:"col-auto q-px-sm"},[a("q-icon",{attrs:{name:"chat",size:"xs"}}),a("span",{staticClass:"text-grey"},[e._v(" ("+e._s(e.metadata.review_count)+")")])],1),a("div",{staticClass:"col-auto"},[a("q-icon",{attrs:{name:"launch",size:"xs"}}),a("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(e.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[e._v("DLsite")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.metadata.title,expression:"metadata.title"}]},[a("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[e._v(e._s(e.metadata.price)+" JPY")]),a("span",[e._v(e._s(e.$t("workCard.sales"))+": "+e._s(e.metadata.dl_count))]),e.metadata.nsfw?e._e():a("span",{staticClass:"q-mx-sm",staticStyle:{background:"#e6f7d6",color:"#56842a"}},[e._v(e._s(e.$t("common.sfw")))]),e.metadata.has_subtitle?a("span",{staticClass:"q-mx-sm",staticStyle:{color:"dodgerblue"}},[e._v(e._s(e.$t("common.translated")))]):e._e()]),e.showTags?a("div",{staticClass:"q-ma-xs"},e._l(e.metadata.tags,(function(t,s){return a("router-link",{key:s,attrs:{to:"/works?tagId="+t.id}},[a("q-chip",{staticClass:"shadow-2",attrs:{size:"md"}},[e._v("\n          "+e._s(t.name)+"\n        ")])],1)})),1):e._e(),a("div",{staticClass:"q-mx-xs q-my-sm"},e._l(e.metadata.vas,(function(t,s){return a("router-link",{key:s,attrs:{to:"/works?vaId="+t.id}},[a("q-chip",{staticClass:"shadow-2",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[e._v("\n          "+e._s(t.name)+"\n        ")])],1)})),1)])],1)},Ce=[],$e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("router-link",{attrs:{to:"/work/RJ"+e.workid}},[a("q-img",{staticStyle:{"max-width":"560px"},attrs:{src:e.coverUrl,ratio:4/3,"img-class":e.imgClass,transition:"fade"},on:{mouseover:function(t){return e.toggleBlurFlag()},mouseout:function(t){return e.toggleBlurFlag()}}},[a("div",{staticClass:"absolute-top-left transparent",staticStyle:{padding:"0"}},[a("q-chip",{staticClass:"q-ma-sm",attrs:{dense:"",square:"",color:"brown","text-color":"white"}},[e._v("\n        "+e._s("RJ"+e.rjcode)+"\n      ")])],1),a("div",{staticClass:"absolute-bottom-right",staticStyle:{padding:"5px"},attrs:{"v-if":e.release}},[e._v("\n      "+e._s(e.release)+"\n    ")])])],1)},Se=[],Ee={name:"CoverSFW",props:{coverUrl:{type:String,required:!0},workid:{type:Number,required:!0},nsfw:{type:Boolean,default:!0},release:{required:!0}},data(){return{blurFlag:!0}},computed:{rjcode(){return("000000"+this.workid).slice(-6)},imgClass(){return this.$q.platform.is.mobile?"":this.nsfw&&this.blurFlag?"blur-image":""}},methods:{toggleBlurFlag(){this.blurFlag=!this.blurFlag}}},Re=Ee,Te=(a("1f5a"),a("068f")),Ne=a("b047"),Pe=Object(h["a"])(Re,$e,Se,!1,null,null,null),Ie=Pe.exports;J()(Pe,"components",{QImg:Te["a"],QChip:Ne["a"]});var Le=a("c221"),Me={name:"WorkCard",mixins:[H["a"]],components:{CoverSFW:Ie},props:{metadata:{type:Object,required:!0},thumbnailMode:{type:Boolean,default:!1}},data(){return{rating:0,userMarked:!1,showTags:!0}},computed:{sortedRatings:function(){function e(e,t){return e.review_point>t.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(e)},coverUrl:function(){return Object(Le["a"])(this.metadata,"main")}},mounted(){this.metadata.userRating?(this.userMarked=!0,this.rating=this.metadata.userRating):(this.userMarked=!1,this.rating=this.metadata.rate_average_2dp||0),this.metadata.tags&&null===this.metadata.tags[0].name&&(this.showTags=!1)},watch:{rating(e,t){if(t){const t={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:e};this.userMarked=!0,this.submitRating(t)}}},methods:{submitRating(e){this.$axios.put("/api/review",e).then(e=>{this.showSuccNotif(e.data.message)}).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})}}},Oe=Me,Qe=a("eb85"),De=a("daf4"),Ae=a("05c0"),Ue=a("6b1d"),je=Object(h["a"])(Oe,xe,Ce,!1,null,null,null),We=je.exports;J()(je,"components",{QCard:U["a"],QSeparator:Qe["a"],QRating:De["a"],QTooltip:Ae["a"],QIcon:oe["a"],QLinearProgress:Ue["a"],QChip:Ne["a"]});var Fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-item",{class:e.classBackgroundColor,staticStyle:{padding:"5px"},attrs:{clickable:"",to:"/work/RJ"+e.metadata.id}},[a("q-item-section",{staticStyle:{padding:"0px 5px 0px 0px"},attrs:{avatar:""}},[a("router-link",{attrs:{to:"/work/RJ"+e.metadata.id}},[a("q-img",{staticStyle:{height:"60px",width:"60px"},attrs:{transition:"fade",src:e.samCoverUrl}})],1)],1),a("q-item-section",[a("q-item-label",{staticClass:"text",attrs:{lines:"2"}},[a("router-link",{staticStyle:{color:"inherit"},attrs:{to:"/work/RJ"+e.metadata.id}},[e._v("\n        "+e._s(e.metadata.title)+"\n      ")])],1),a("q-item-label",[a("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},[a("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?circleId="+e.metadata.circle.id}},[e._v("\n          "+e._s(e.metadata.circle.name)+"\n        ")]),a("span",{staticClass:"col-auto"},[e._v("/")]),e._l(e.metadata.vas,(function(t,s){return a("router-link",{key:s,staticClass:"col-auto text-primary",attrs:{to:"/works?vaId="+t.id}},[e._v("\n          "+e._s(t.name)+"\n        ")])}))],2)]),e.showLabel&&e.$q.screen.width>700?a("q-item-label",[a("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},e._l(e.metadata.tags,(function(t,s){return a("router-link",{key:s,staticClass:"col-auto text-grey",attrs:{to:"/works?tagId="+t.id}},[e._v("\n          "+e._s(t.name)+"\n        ")])})),1)]):e._e()],1)],1)},Be=[],ze=a("c1a2"),Je={name:"WorkListItem",mixins:[ze["a"]],props:{metadata:{type:Object,required:!0},showLabel:{type:Boolean,default:!0}},computed:{samCoverUrl(){return Object(Le["a"])(this.metadata,"sam")}}},Ye=Je,Ge=Object(h["a"])(Ye,Fe,Be,!1,null,null,null),He=Ge.exports;J()(Ge,"components",{QItem:de["a"],QItemSection:ue["a"],QImg:Te["a"],QItemLabel:pe["a"]});var Ke={name:"Works",mixins:[H["a"],ze["a"]],components:{WorkCard:We,WorkListItem:He},data(){return{lastQueryBeforeDeactivate:"",active:!1,displayMode:"detail",showLabel:!0,detailMode:!1,stopLoad:!1,loading:!0,works:[],pageTitle:"",page:1,pagination:{currentPage:0,pageSize:12,totalCount:0},seed:7,subtitleOnly:!1,previousUrl:"",sortOption:{label:this.$t("works.new"),order:"create_date",sort:"desc"},options:[{label:this.$t("works.releaseDesc"),order:"release",sort:"desc"},{label:this.$t("works.new"),order:"create_date",sort:"desc"},{label:this.$t("works.ratingDesc"),order:"rating",sort:"desc"},{label:this.$t("works.releaseAsc"),order:"release",sort:"asc"},{label:this.$t("works.dlCountDesc"),order:"dl_count",sort:"desc"},{label:this.$t("works.priceAsc"),order:"price",sort:"asc"},{label:this.$t("works.priceDesc"),order:"price",sort:"desc"},{label:this.$t("works.rateAverage2dpDesc"),order:"rate_average_2dp",sort:"desc"},{label:this.$t("works.reviewCountDesc"),order:"review_count",sort:"desc"},{label:this.$t("works.idDesc"),order:"id",sort:"desc"},{label:this.$t("works.idAsc"),order:"id",sort:"asc"},{label:this.$t("works.sfwOnly"),order:"nsfw",sort:"asc"},{label:this.$t("works.random"),order:"random",sort:"desc"}]}},created(){this.refreshPageTitle(),this.seed=Math.floor(100*Math.random())},mounted(){if(localStorage.sortOption)try{let e=JSON.parse(localStorage.sortOption);this.sortOption=this.options.find(t=>e.order===t.order&&e.sort===t.sort)}catch{localStorage.removeItem("sortOption")}localStorage.displayMode&&(this.displayMode=localStorage.displayMode),this.requestWorksQueue()},computed:{...Object(v["d"])("User",{userName:"name"}),maxPage(){return Math.ceil(this.pagination.totalCount/this.pagination.pageSize)},url(){const e=this.$route.query;return e.circleId?`/api/circles/${this.$route.query.circleId}/works`:e.tagId?`/api/tags/${this.$route.query.tagId}/works`:e.vaId?`/api/vas/${this.$route.query.vaId}/works`:e.keyword?"/api/search/"+e.keyword:"/api/works"}},activated(){this.stopLoad=!1,JSON.stringify(this.lastQueryBeforeDeactivate)!==JSON.stringify(this.$route.query)&&(this.lastQueryBeforeDeactivate=this.$route.query,this.reset()),this.active=!0},deactivated(){this.stopLoad=!0,this.active=!1},watch:{url(){this.active&&(this.reset(),this.lastQueryBeforeDeactivate=this.$route.query)},sortOption(e,t){console.log(`Sort option changed! old: ${JSON.stringify(t)}, new: ${JSON.stringify(e)}`),JSON.stringify(t)!==JSON.stringify(e)&&(localStorage.sortOption=JSON.stringify(e),this.seed=Math.floor(100*Math.random()),this.reset())},subtitleOnly(){this.reset()},showLabel(e){localStorage.showLabel=e},listMode(e){localStorage.listMode=e},detailMode(e){localStorage.detailMode=e},page(){document.getElementById("gotop")&&document.getElementById("gotop").click(),this.requestWorksQueue()}},methods:{requestWorksQueue(){this.loading=!0,this.works={};const e={order:this.sortOption.order,sort:this.sortOption.sort,page:this.page,seed:this.seed,subtitle:this.subtitleOnly?1:0};return this.$axios.get(this.url,{params:e}).then(e=>{this.loading=!1;const t=e.data.works;this.works=t.concat(),this.pagination=e.data.pagination,this.works.length>=this.pagination.totalCount&&(this.stopLoad=!0)}).catch(e=>{this.loading=!1,e.response?401!==e.response.status&&this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e),this.stopLoad=!0})},refreshPageTitle(){if(this.$route.query.circleId||this.$route.query.tagId||this.$route.query.vaId){let e="",t="";this.$route.query.circleId?(t="circles",e=`/api/${t}/${this.$route.query.circleId}`):this.$route.query.tagId?(t="tags",e=`/api/${t}/${this.$route.query.tagId}`):(t="vas",e=`/api/${t}/${this.$route.query.vaId}`),this.$axios.get(e).then(e=>{const a=e.data.name;let s;switch(t){case"tags":s="Works tagged with ";break;case"vas":s="Works voiced by ";break;case"circles":s="Works by ";break}s+=a||"",this.pageTitle=s}).catch(e=>{e.response?401!==e.response.status&&this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})}else this.$route.query.keyword?this.pageTitle="Search by "+this.$route.query.keyword:this.pageTitle="All works"},reset(){this.stopLoad=!1,this.refreshPageTitle(),this.pagination={currentPage:0,pageSize:12,totalCount:0},1===this.page?this.requestWorksQueue():this.page=1}}},Ve=Ke,Xe=(a("eef3"),a("ef35")),Ze=a("ddd8"),et=a("8f8e"),tt=a("6a67"),at=a("8380"),st=a("3b16"),rt=Object(h["a"])(Ve,ye,_e,!1,null,"4c342ee3",null),it=rt.exports;J()(rt,"components",{QInfiniteScroll:Xe["a"],QPage:we["a"],QSelect:Ze["a"],QCheckbox:et["a"],QBtnToggle:tt["a"],QList:ce["a"],QSpinnerDots:at["a"],QPagination:st["a"]});var ot=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("WorkDetails",{attrs:{metadata:e.metadata},on:{reset:function(t){return e.requestData()}}}),a("WorkTree",{attrs:{tree:e.tree,editable:!1}})],1)},nt=[],lt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("router-link",{attrs:{to:"/work/RJ"+e.metadata.id}},[a("CoverSFW",{attrs:{"cover-url":e.coverUrl,workid:e.metadata.id,nsfw:!1,release:e.metadata.release}})],1),a("div",{staticClass:"q-pa-sm"},[a("div",{staticClass:"q-px-sm q-py-none"},[a("div",{staticClass:"text-h6 text-weight-regular"},[a("router-link",{class:e.classTextColor,attrs:{to:"/work/RJ"+e.metadata.id}},[e._v("\n          "+e._s(e.metadata.title)+"\n        ")])],1),a("div",{staticClass:"text-subtitle1 text-weight-regular"},[a("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+e.metadata.circle.id}},[e._v("\n          "+e._s(e.metadata.circle.name)+"\n        ")])],1),a("div",{staticClass:"row items-center q-gutter-xs"},[a("div",{staticClass:"col-auto"},[a("q-rating",{attrs:{name:"rating",size:"sm",color:e.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},on:{input:e.setRating},model:{value:e.rating,callback:function(t){e.rating=t},expression:"rating"}}),e.metadata.rate_count_detail?a("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[a("div",[e._v("平均: "+e._s(e.metadata.rate_average_2dp))]),e._l(e.sortedRatings,(function(t,s){return a("div",{key:s,staticClass:"row items-center"},[a("div",{staticClass:"col"},[e._v(" "+e._s(t.review_point)+"星 ")]),a("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:t.ratio/100,color:"amber","track-color":"white"}}),a("div",{staticClass:"col q-mx-sm"},[e._v(" ("+e._s(t.count)+") ")])],1)}))],2):e._e()],1),a("div",{staticClass:"col-auto"},[a("span",{staticClass:"text-weight-medium text-body1 text-red"},[e._v(e._s(e.metadata.rate_average_2dp))]),a("span",{staticClass:"text-grey"},[e._v(" ("+e._s(e.metadata.rate_count)+")")])]),a("div",{staticClass:"col-auto q-px-sm"},[a("q-icon",{attrs:{name:"chat",size:"xs"}}),a("span",{staticClass:"text-grey"},[e._v(" ("+e._s(e.metadata.review_count)+")")])],1),a("div",{staticClass:"col-auto"},[a("q-icon",{attrs:{name:"launch",size:"xs"}}),a("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(e.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[e._v("DLsite")])],1)])]),a("div",{staticClass:"q-pt-sm q-pb-none"},[a("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[e._v(e._s(e.metadata.price)+" JPY")]),e._v(" "+e._s(e.$t("workDetail.sales"))+": "+e._s(e.metadata.dl_count)+"\n    ")]),e.showTags?a("div",{staticClass:"q-px-none q-py-sm"},e._l(e.metadata.tags,(function(t,s){return a("router-link",{key:s,attrs:{to:"/works?tagId="+t.id}},[a("q-chip",{staticClass:"shadow-4",attrs:{size:"md"}},[e._v("\n          "+e._s(t.name)+"\n        ")])],1)})),1):e._e(),a("div",{staticClass:"q-px-none q-pt-sm q-py-sm"},e._l(e.metadata.vas,(function(t,s){return a("router-link",{key:s,attrs:{to:"/works?vaId="+t.id}},[a("q-chip",{staticClass:"shadow-4",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[e._v("\n          "+e._s(t.name)+"\n        ")])],1)})),1),a("q-btn-dropdown",{staticClass:"q-mt-sm shadow-4 q-mx-xs q-pl-sm",attrs:{dense:"",color:"cyan",label:e.$t("workDetail.progress")}},[a("q-list",[a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(t){return e.setProgress("marked")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"marked"===e.progress,expression:"progress === 'marked'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("common.progressEnum.marked")))])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(t){return e.setProgress("listening")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listening"===e.progress,expression:"progress === 'listening'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("common.progressEnum.listening")))])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(t){return e.setProgress("listened")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listened"===e.progress,expression:"progress === 'listened'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("common.progressEnum.listened")))])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(t){return e.setProgress("replay")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"replay"===e.progress,expression:"progress === 'replay'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("common.progressEnum.replay")))])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(t){return e.setProgress("postponed")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"postponed"===e.progress,expression:"progress === 'postponed'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("common.progressEnum.postponed")))])],1)],1)],1)],1),a("q-btn",{attrs:{dense:"",color:"cyan q-mt-sm shadow-4 q-mx-xs q-px-sm",label:e.$t("workDetail.writeReview")},on:{click:function(t){e.showReviewDialog=!0}}}),e.showReviewDialog?a("WriteReview",{attrs:{workid:e.metadata.id,metadata:e.metadata},on:{closed:e.processReview}}):e._e()],1)],1)},ct=[],dt=a("c16d"),ut={name:"WorkDetails",mixins:[H["a"],ze["a"]],components:{CoverSFW:Ie,WriteReview:dt["a"]},props:{metadata:{type:Object,required:!0}},data(){return{rating:0,userMarked:!1,progress:"",showReviewDialog:!1,showTags:!0}},computed:{sortedRatings:function(){function e(e,t){return e.review_point>t.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(e)},coverUrl:function(){return Object(Le["a"])(this.metadata,"main")}},watch:{metadata(e){e.userRating?(this.userMarked=!0,this.rating=e.userRating):(this.userMarked=!1,this.rating=e.rate_average_2dp||0),this.progress=e.progress,e.tags&&null===e.tags[0].name&&(this.showTags=!1)}},methods:{setProgress(e){this.progress=e;const t={user_name:this.$store.state.User.name,work_id:this.metadata.id,progress:e};this.submitProgress(t)},submitProgress(e){const t={starOnly:!1,progressOnly:!0};this.$axios.put("/api/review",e,{params:t}).then(e=>{this.showSuccNotif(e.data.message),this.$emit("reset")}).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})},setRating(e){const t={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:e};this.submitRating(t)},submitRating(e){this.$axios.put("/api/review",e).then(e=>{this.showSuccNotif(e.data.message),this.$emit("reset")}).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})},processReview(){this.showReviewDialog=!1}},mounted(){this.$store.commit("AudioPlayer/LOAD_PLAYER")}},pt=ut,mt=a("f20b"),ht=Object(h["a"])(pt,lt,ct,!1,null,null,null),gt=ht.exports;J()(ht,"components",{QRating:De["a"],QTooltip:Ae["a"],QLinearProgress:Ue["a"],QIcon:oe["a"],QChip:Ne["a"],QBtnDropdown:mt["a"],QList:ce["a"],QItem:de["a"],QItemSection:ue["a"],QAvatar:he["a"],QItemLabel:pe["a"],QBtn:F["a"]});var wt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"q-ma-md "},[e.path.length?a("q-breadcrumbs",{attrs:{gutter:"xs"}},[a("q-breadcrumbs-el",[a("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(t){e.path=[]}}},[e._v("ROOT")])],1),e._l(e.path,(function(t,s){return a("q-breadcrumbs-el",{key:s,staticClass:"cursor-pointer"},[a("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(t){return e.onClickBreadcrumb(s)}}},[e._v(e._s(t))])],1)}))],2):e._e(),a("q-card",[a("q-list",{attrs:{separator:""}},e._l(e.fatherFolder,(function(t,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"non-selectable",attrs:{clickable:"",active:"audio"===t.type&&e.currentPlayingFile.hash===t.hash,"active-class":"text-white bg-teal"},on:{click:function(a){return e.onClickItem(t)}}},[a("q-item-section",{attrs:{avatar:""}},["folder"===t.type?a("q-icon",{attrs:{size:"34px",color:"amber",name:"folder"}}):"text"===t.type?a("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):"image"===t.type?a("q-icon",{attrs:{size:"34px",color:"orange",name:"photo"}}):"other"===t.type?a("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):a("q-btn",{attrs:{round:"",dense:"",color:"primary",icon:e.playIcon(t.hash)},on:{click:function(a){return e.onClickPlayButton(t.hash)}}})],1),a("q-item-section",[a("q-item-label",{attrs:{lines:"2"}},[e._v(e._s(t.title))]),t.children?a("q-item-label",{attrs:{caption:"",lines:"1"}},[e._v(e._s(t.children.length+" 项目"))]):e._e()],1),"audio"===t.type||"text"===t.type||"image"===t.type||"other"===t.type?a("q-menu",{attrs:{"touch-position":"","context-menu":"","auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"}},[a("q-list",{attrs:{separator:""}},["audio"===t.type?a("q-item",{attrs:{clickable:""},on:{click:function(a){return e.addToQueue(t)}}},[a("q-item-section",[e._v("添加到播放列表")])],1):e._e(),"audio"===t.type?a("q-item",{attrs:{clickable:""},on:{click:function(a){return e.playNext(t)}}},[a("q-item-section",[e._v("下一曲播放")])],1):e._e(),a("q-item",{attrs:{clickable:""},on:{click:function(a){return e.download(t)}}},[a("q-item-section",[e._v("下载文件")])],1)],1)],1):e._e()],1)})),1)],1)],1)},vt=[],ft={name:"WorkTree",data(){return{path:[]}},props:{tree:{type:Array,required:!0}},watch:{tree(){this.initPath()}},computed:{fatherFolder(){let e=this.tree.concat();return this.path.forEach(t=>{e=e.find(e=>"folder"===e.type&&e.title===t).children}),e},queue(){const e=[];return this.fatherFolder.forEach(t=>{"audio"===t.type&&e.push(t)}),e},...Object(v["d"])("AudioPlayer",["playing"]),...Object(v["b"])("AudioPlayer",["currentPlayingFile"])},methods:{playIcon(e){return this.playing&&this.currentPlayingFile.hash===e?"pause":"play_arrow"},initPath(){const e=[];let t=this.tree.concat();while(1===t.length){if("audio"===t[0].type)break;e.push(t[0].title),t=t[0].children}this.path=e},onClickBreadcrumb(e){this.path=this.path.slice(0,e+1)},onClickItem(e){"folder"===e.type?this.path.push(e.title):"text"===e.type||"image"===e.type?this.openFile(e):"other"===e.type?this.download(e):this.currentPlayingFile.hash!==e.hash&&this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(t=>t.hash===e.hash),resetPlaying:!0})},onClickPlayButton(e){this.currentPlayingFile.hash===e?this.$store.commit("AudioPlayer/TOGGLE_WANT_PLAYING"):this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(t=>t.hash===e),resetPlaying:!0})},addToQueue(e){this.$store.commit("AudioPlayer/ADD_TO_QUEUE",e)},playNext(e){this.$store.commit("AudioPlayer/PLAY_NEXT",e)},download(e){const t=this.$q.localStorage.getItem("jwt-token")||"",a=e.mediaDownloadUrl?`${e.mediaDownloadUrl}?token=${t}`:Object(Le["b"])(e.hash,t),s=document.createElement("a");s.href=a,s.target="_blank",s.click()},openFile(e){const t=this.$q.localStorage.getItem("jwt-token")||"",a=e.mediaStreamUrl?`${e.mediaStreamUrl}?token=${t}`:Object(Le["c"])(e.hash,t),s=document.createElement("a");s.href=a,s.target="_blank",s.click()}}},bt=ft,kt=a("ead5"),qt=a("079e"),yt=a("4e73"),_t=Object(h["a"])(bt,wt,vt,!1,null,null,null),xt=_t.exports;J()(_t,"components",{QBreadcrumbs:kt["a"],QBreadcrumbsEl:qt["a"],QBtn:F["a"],QCard:U["a"],QList:ce["a"],QItem:de["a"],QItemSection:ue["a"],QIcon:oe["a"],QItemLabel:pe["a"],QMenu:yt["a"]}),J()(_t,"directives",{Ripple:be["a"]});var Ct={name:"Work",mixins:[H["a"]],components:{WorkDetails:gt,WorkTree:xt},data(){return{workid:this.$route.params.id,metadata:{id:parseInt(this.$route.params.id),circle:{}},tree:[]}},watch:{$route(e){this.workid=e.params.id,this.requestData()}},created(){this.requestData()},methods:{requestData(){this.$axios.get("/api/work/"+this.workid).then(e=>{this.metadata=e.data}).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)}),this.$axios.get("/api/tracks/"+this.workid).then(e=>{this.tree=e.data}).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})}}},$t=Ct,St=Object(h["a"])($t,ot,nt,!1,null,null,null),Et=St.exports,Rt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-form",{staticClass:"absolute-center\tq-gutter-md",staticStyle:{width:"260px"},on:{submit:e.onSubmit}},[a("q-input",{staticClass:"fit",attrs:{filled:"",label:e.$t("login.username"),"lazy-rules":"",rules:[function(t){return t&&t.length>=5||e.$t("login.usernameLengthNotEnough",[5])}]},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),a("q-input",{staticClass:"fit",attrs:{filled:"",type:"password",label:e.$t("login.password"),"lazy-rules":"",rules:[function(t){return t&&t.length>=5||e.$t("login.passwordLengthNotEnough",[5])}],clearable:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e.showRegisterForm?a("q-input",{staticClass:"fit",attrs:{filled:"",type:"password",label:e.$t("login.repeatPassword"),"lazy-rules":"","bottom-slots":"",rules:[function(t){return t&&t===e.password||e.$t("login.repeatPasswordNotMatch")}],clearable:""},model:{value:e.passwordConfirm,callback:function(t){e.passwordConfirm=t},expression:"passwordConfirm"}}):e._e(),e.showRegisterForm?e._e():a("q-btn",{staticClass:"fit",attrs:{label:e.$t("login.login"),type:"submit",color:"primary"}}),a("div",{staticClass:"row fit no-wrap justify-between"},[e.showRegisterForm?e._e():a("q-btn",{staticStyle:{"max-width":"5em"},attrs:{label:e.$t("login.guestLogin"),flat:"",dense:"",color:"accent"},on:{click:e.guestLogin}}),this.$store.state.User.reg&&!e.showRegisterForm?a("q-btn",{staticStyle:{"max-width":"5em"},attrs:{label:e.$t("login.register"),flat:"",dense:"",color:"secondary"},on:{click:e.navigateToRegister}}):e._e()],1),e.showRegisterForm?a("q-btn",{staticClass:"fit",attrs:{label:e.$t("login.postRegister"),type:"submit",color:"primary"}}):e._e(),e.showRegisterForm?a("q-btn",{attrs:{label:e.$t("login.backToLogin"),flat:"",dense:"",color:"secondary"},on:{click:e.navigateBack}}):e._e()],1)},Tt=[],Nt=a("bc3a"),Pt=a.n(Nt);function It(e){Pt.a.defaults.headers["Authorization"]="Bearer "+e}Pt.a.defaults.headers["Content-Type"]="application/json",Pt.a.defaults.headers["Authorization"]=n["a"].getItem("jwt-token")?"Bearer "+n["a"].getItem("jwt-token"):"",Pt.a.defaults.baseURL="https://api.asmr.one",s["a"].prototype.$axios=Pt.a;var Lt={mixins:[H["a"]],data(){return{name:"",password:"",passwordConfirm:"",showRegisterForm:!1}},mounted(){this.checkRegEnable()},methods:{navigateToRegister(){this.showRegisterForm=!0},navigateBack(){this.showRegisterForm=!1},onSubmit(){this.showRegisterForm?this.reg():this.login()},checkRegEnable(){this.$axios.get("/api/auth/reg").then(e=>{this.$store.commit("User/SET_REG",e.data.reg)})},login(){let e=this.$axios.post("/api/auth/me",{name:this.name,password:this.password});this.handleResponse(e,"login")},guestLogin(){let e=this.$axios.post("/api/auth/me",{name:"guest",password:"guest"});this.handleResponse(e,"login")},reg(){let e=this.$axios.post("/api/auth/reg",{name:this.name,password:this.password});this.handleResponse(e,"reg")},handleResponse(e,t){e.then(e=>{try{this.$q.localStorage.set("jwt-token",e.data.token),It(e.data.token),this.showSuccNotif("reg"===t?this.$t("login.registerSuccess"):this.$t("login.loginSuccess")),this.$router.push("/")}catch(a){this.showErrNotif(a.message)}}).catch(e=>{e.response?401===e.response.status?this.showWarnNotif(e.response.data.error):this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})}}},Mt=Lt,Ot=a("0378"),Qt=Object(h["a"])(Mt,Rt,Tt,!1,null,null,null),Dt=Qt.exports;function At(e,t){return t.map(t=>(t.path=e+""+t.path,t))}J()(Qt,"components",{QForm:Ot["a"],QInput:ie["a"],QBtn:F["a"]});const Ut=[{path:"/admin",component:()=>a.e(7).then(a.bind(null,"8265")),children:[{path:"",component:()=>a.e(13).then(a.bind(null,"9ad9"))},{path:"scanner",component:()=>a.e(14).then(a.bind(null,"7ca0"))},{path:"advanced",component:()=>a.e(12).then(a.bind(null,"1e24"))},{path:"usermanage",component:()=>a.e(15).then(a.bind(null,"09ef"))}]},{path:"/",component:qe,children:[{path:"",redirect:{name:"works"}},{path:"works",name:"works",component:it},{path:"work/RJ:id",component:Et},{path:"work/:id",component:Et},{path:"circles",props:{restrict:"circles"},component:()=>a.e(1).then(a.bind(null,"e00c"))},{path:"tags",props:{restrict:"tags"},component:()=>a.e(1).then(a.bind(null,"e00c"))},{path:"vas",props:{restrict:"vas"},component:()=>a.e(1).then(a.bind(null,"e00c"))},{path:"about",props:{restrict:"about"},component:()=>a.e(8).then(a.bind(null,"a1d1"))},...At("favourites",[{path:"",props:{route:"review"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/review",props:{route:"review"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},...At("/progress",[{path:"",props:{route:"progress",progress:"marked"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/marked",props:{route:"progress",progress:"marked"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/listening",props:{route:"progress",progress:"listening"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/listened",props:{route:"progress",progress:"listened"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/replay",props:{route:"progress",progress:"replay"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/postponed",props:{route:"progress",progress:"postponed"},component:()=>a.e(0).then(a.bind(null,"ddf4"))}]),{path:"/folder",props:{route:"folder"},component:()=>a.e(0).then(a.bind(null,"ddf4"))}])],meta:{auth:!0}},{path:"/login",component:Dt}];Ut.push({path:"*",component:()=>a.e(9).then(a.bind(null,"e51e"))});var jt=Ut;s["a"].use(P["a"]);var Wt=function(){const e=new P["a"]({scrollBehavior(e,t,a){return a||{x:0,y:0}},routes:jt,mode:"history",base:"/"});return e},Ft=async function(){const e="function"===typeof N?await N({Vue:s["a"]}):N,t="function"===typeof Wt?await Wt({Vue:s["a"],store:e}):Wt;e.$router=t;const a={router:t,store:e,render:e=>e(w),el:"#q-app"};return{app:a,store:e,router:t}},Bt=a("a925"),zt={username:"用户名",password:"密码",login:"登录",guestLogin:"游客登录",register:"注册",usernameLengthNotEnough:"用户名长度至少为 {0}",passwordLengthNotEnough:"密码长度至少为 {0}",repeatPassword:"请再次输入密码",repeatPasswordNotMatch:"两次输入的密码不一致",postRegister:"去看看！",backToLogin:"返回",loginSuccess:"登录成功",registerSuccess:"注册成功"},Jt={library:"媒体库",myFavourites:"我的收藏",circles:"社团",tags:"标签",vas:"声优",randomPlay:"随心听",sleepMode:"睡眠模式",darkMode:"夜间模式",about:"关于",logout:"登出",doubleCheckLogout:"是否退出登录？",doubleCheckLogoutCancel:"取消",doubleCheckLogoutConfirm:"退出"},Yt={sort:"排序",releaseDesc:"发售日期倒序",new:"最新收录",ratingDesc:"我的评价倒序",releaseAsc:"发售日期顺序",dlCountDesc:"销量倒序",priceAsc:"价格顺序",priceDesc:"价格倒序",rateAverage2dpDesc:"评价倒序",reviewCountDesc:"评论数量倒序",idDesc:"RJ号倒序",idAsc:"RJ号顺序",sfwOnly:"全年龄顺序",random:"随机排序",guestLoginRateLimitTips:"小提示: 使用 guest 账号加载速度会受到限制，推荐注册属于自己的账号。"},Gt={averageStar:"平均",sales:"销量"},Ht={sfw:"全年龄",translated:"带字幕",progressEnum:{marked:"想听",listening:"在听",listened:"听过",replay:"重听",postponed:"搁置"},comingSoon:"尚未实现，敬请期待"},Kt={averageStar:"平均",sales:"销量",progress:"标记进度",writeReview:"写评论"},Vt={myReview:"我的评论",deleteMarker:"删除标记",secondConfirmDeleteMarker:"确定要删除标记吗？",secondConfirmYes:"确定",secondConfirmNo:"取消",submitReview:"确定",closeReview:"取消"},Xt={myReview:"我的评价",myProgress:"我的进度",folder:"分类整理",sortOptions:{markedTime:"标记时间",rating:"评价",releaseDate:"发布时间",reviewCount:"评论数量",dlCount:"售出数量",sfw:"全年龄新作",nsfw:"18禁新作"},favouriteEmptyTips:"在作品界面上点击星标、标记进度，标记的音声就会出现在这里啦"},Zt={common:Ht,login:zt,sidebar:Jt,works:Yt,workCard:Gt,workDetail:Kt,writeReview:Vt,favourites:Xt},ea={username:"Username",password:"Password",login:"Login",guestLogin:"Guest",register:"Register",usernameLengthNotEnough:"Username length must be at least {0} characters",passwordLengthNotEnough:"Password length must be at least {0} characters",repeatPassword:"Repeat Password",repeatPasswordNotMatch:"Repeat password not match",postRegister:"Register",backToLogin:"Back to Login",loginSuccess:"Login success",registerSuccess:"Register success"},ta={library:"Library",myFavourites:"My Favourites",circles:"Circles",tags:"Tags",vas:"VAs",randomPlay:"Random Play",sleepMode:"Sleep Mode",darkMode:"Dark Mode",about:"About",logout:"Logout",doubleCheckLogout:"Are you sure you want to log out?",doubleCheckLogoutCancel:"Cancel",doubleCheckLogoutConfirm:"Log out"},aa={sort:"Sort",releaseDesc:"Release date descending",new:"Newest",ratingDesc:"My rating descending",releaseAsc:"Release date ascending",dlCountDesc:"Sales count descending",priceAsc:"Price ascending",priceDesc:"Price descending",rateAverage2dpDesc:"Rating descending",reviewCountDesc:"Review count descending",idDesc:"RJ code descending",idAsc:"RJ code ascending",sfwOnly:"SFW only",random:"Random",guestLoginRateLimitTips:"Tip: If you use guest login, you will be limited by speed. It's better to register your own account."},sa={averageStar:"Average",sales:"Sales"},ra={sfw:"SFW",translated:"Translated",progressEnum:{marked:"Marked",listening:"Listening",listened:"Listened",replay:"Replay",postponed:"Postponed"},comingSoon:"Coming soon"},ia={averageStar:"Average",sales:"Sales",progress:"Progress",writeReview:"Write a review"},oa={myReview:"My Review",deleteMarker:"Delete Marker",secondConfirmDeleteMarker:"Are you sure you want to delete this marker?",secondConfirmYes:"Yes",secondConfirmNo:"No",submitReview:"Submit",closeReview:"Close"},na={myReview:"My Review",myProgress:"My Progress",folder:"Folder",sortOptions:{markedTime:"Marked Time",rating:"Rating",releaseDate:"Release Date",reviewCount:"Review Count",dlCount:"Sales Count",sfw:"SFW",nsfw:"NSFW"},favouriteEmptyTips:"mark a progress or write a review to a work, it will appear here"},la={common:ra,login:ea,sidebar:ta,works:aa,workCard:sa,workDetail:ia,writeReview:oa,favourites:na},ca={"zh-CN":Zt,en:la},da=a("fe09");const ua={"zh-Hans":"zh-CN","zh-Hant":"zh-CN","zh-cn":"zh-CN"};function pa(e){return ua[e]||e}var ma=pa;s["a"].use(Bt["a"]);var ha=({app:e})=>{e.i18n=new Bt["a"]({locale:ma(da["a"].lang.getLocale()),fallbackLocale:"en",messages:ca})};async function ga(){const{app:e,store:t,router:a}=await Ft();let r=!0;const i=e=>{r=!1,window.location.href=e},o=window.location.href.replace(window.location.origin,""),n=[void 0,ha];for(let c=0;!0===r&&c<n.length;c++)if("function"===typeof n[c])try{await n[c]({app:e,router:a,store:t,Vue:s["a"],ssrContext:null,redirect:i,urlPath:o})}catch(l){return l&&l.url?void(window.location.href=l.url):void console.error("[Quasar] boot error:",l)}!1!==r&&new s["a"](e)}ga()},"31cd":function(e,t,a){},"5fde":function(e,t,a){"use strict";var s=a("9066"),r=a.n(s);r.a},"6a18":function(e,t){},"89d3":function(e,t,a){"use strict";var s=a("e87e"),r=a.n(s);r.a},"8e3b":function(e,t,a){},9066:function(e,t,a){},9224:function(e){e.exports=JSON.parse('{"a":"1.1.2"}')},b5fb:function(e,t){},c16d:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-dialog",{on:{hide:e.closeDialog},model:{value:e.showReviewDialog,callback:function(t){e.showReviewDialog=t},expression:"showReviewDialog"}},[a("q-card",[a("q-card-section",{staticClass:"q-pb-sm"},[a("div",{staticClass:"text-body1"},[e._v(e._s(e.$t("writeReview.myReview")))])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-rating",{staticClass:"col-auto",attrs:{size:"sm",color:"blue",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:e.rating,callback:function(t){e.rating=t},expression:"rating"}}),a("q-btn-toggle",{class:e.$q.screen.lt.sm?"my-custom-toggle q-mx-none q-mt-sm":"my-custom-toggle q-mx-md",attrs:{"no-caps":"",rounded:"",unelevated:"",padding:e.$q.screen.width<400?"sm":"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:this.$t("common.progressEnum.marked"),value:"marked"},{label:this.$t("common.progressEnum.listening"),value:"listening"},{label:this.$t("common.progressEnum.listened"),value:"listened"},{label:this.$t("common.progressEnum.replay"),value:"replay"},{label:this.$t("common.progressEnum.postponed"),value:"postponed"}]},model:{value:e.progress,callback:function(t){e.progress=t},expression:"progress"}})],1),a("q-card-section",{staticClass:"q-pt-none"},[a("div",{staticStyle:{"min-width":"300px"}},[a("q-input",{attrs:{filled:"",type:"textarea"},model:{value:e.reviewText,callback:function(t){e.reviewText=t},expression:"reviewText"}})],1)]),a("div",{staticClass:"row justify-between"},[a("q-card-actions",{staticClass:"text-red"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("writeReview.deleteMarker")},on:{click:function(t){e.deleteConfirm=!0}}})],1),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("writeReview.submitReview")},on:{click:function(t){return e.submitReview()}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("writeReview.closeReview")},on:{click:function(t){return e.closeDialog()}}})],1)],1)],1)],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:e.deleteConfirm,callback:function(t){e.deleteConfirm=t},expression:"deleteConfirm"}},[a("q-card",{staticClass:"bg-teal text-white",staticStyle:{width:"300px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("writeReview.secondConfirmDeleteMarker")))])]),a("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("writeReview.secondConfirmYes")},on:{click:function(t){return e.deleteReview()}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:e.$t("writeReview.secondConfirmNo")},on:{click:function(t){return e.closeDialog()}}})],1)],1)],1)],1)},r=[],i=a("2d97"),o={name:"WriteReview",mixins:[i["a"]],props:{workid:{type:Number,required:!0},metadata:{type:Object,default:null}},data(){return{showReviewDialog:!0,deleteConfirm:!1,rating:0,reviewText:"",modified:!1,progress:""}},mounted(){this.metadata.userRating&&(this.rating=this.metadata.userRating),this.progress=this.metadata.progress,this.reviewText=this.metadata.review_text},methods:{closeDialog(){this.deleteConfirm||(this.modified?this.$emit("closed",!0):this.$emit("closed",!1))},reviewPayload(){const e={user_name:this.$store.state.User.name,work_id:this.workid,rating:this.rating,review_text:this.reviewText,progress:this.progress};return e},submitReview(){const e={starOnly:!1},t=this.reviewPayload();this.$axios.put("/api/review",t,{params:e}).then(e=>{this.modified=!0,this.showSuccNotif(e.data.message)}).then(()=>this.closeDialog()).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})},deleteReview(){const e={work_id:this.workid};this.$axios.delete("/api/review",{params:e}).then(e=>{this.modified=!0,this.showSuccNotif(e.data.message)}).then(()=>this.closeDialog()).catch(e=>{e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})}}},n=o,l=(a("5fde"),a("2877")),c=a("24e8"),d=a("f09f"),u=a("a370"),p=a("daf4"),m=a("6a67"),h=a("27f9"),g=a("4b7e"),w=a("9c40"),v=a("7f67"),f=a("eebe"),b=a.n(f),k=Object(l["a"])(n,s,r,!1,null,"52100efe",null);t["a"]=k.exports;b()(k,"components",{QDialog:c["a"],QCard:d["a"],QCardSection:u["a"],QRating:p["a"],QBtnToggle:m["a"],QInput:h["a"],QCardActions:g["a"],QBtn:w["a"]}),b()(k,"directives",{ClosePopup:v["a"]})},c1a2:function(e,t,a){"use strict";t["a"]={computed:{color(){return this.$q.dark.isActive?"black":"white"},textColor(){return this.$q.dark.isActive?"white":"black"},classTextColor(){return this.$q.dark.isActive?"text-white":"text-black"},classBackgroundColor(){return this.$q.dark.isActive?"bg-black":"bg-white"}}}},c221:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return i}));const s=(e,t="main")=>{if(e=e||{samCoverUrl:"",thumbnailCoverUrl:"",mainCoverUrl:""},!e.id&&!e.hash.split("/")[0])return"";switch(t){case"main":return e.mainCoverUrl?e.mainCoverUrl:`https://api.asmr.one/api/cover/${e.id||e.hash.split("/")[0]}.jpg?type=main`;case"sam":return e.samCoverUrl?e.samCoverUrl:`https://api.asmr.one/api/cover/${e.id||e.hash.split("/")[0]}.jpg?type=sam`;case"thumb":return e.thumbnailCoverUrl?e.thumbnailCoverUrl:`https://api.asmr.one/api/cover/${e.id||e.hash.split("/")[0]}.jpg?type=240x240`;default:return`https://api.asmr.one/api/cover/${e.id||e.hash.split("/")[0]}.jpg?type=${t}`}},r=(e,t)=>`https://api.asmr.one/api/media/stream/${e}?token=${t}`,i=(e,t)=>`https://api.asmr.one/api/media/download/${e}?token=${t}`},e87e:function(e,t,a){},eef3:function(e,t,a){"use strict";var s=a("0d64"),r=a.n(s);r.a}},[[0,4,2]]]);